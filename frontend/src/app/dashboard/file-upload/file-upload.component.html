<div class="file-upload-container">
    <h2>Carga de Archivos Excel</h2>
    <p class="subtitle">Importa datos de ventas y compras desde archivos Excel</p>

    <!-- Selector de Tipo de Archivo -->
    <div class="type-selector-section" *ngIf="!uploadResult && !isUploading">
        <h3>Selecciona el tipo de datos a cargar:</h3>
        <mat-radio-group [(ngModel)]="uploadType" class="type-radio-group">
            <mat-radio-button value="ventas" color="primary">Ventas</mat-radio-button>
            <mat-radio-button value="compras" color="primary">Compras</mat-radio-button>
        </mat-radio-group>
    </div>

    <!-- Botón para descargar plantilla -->
    <div class="template-section">
        <button mat-raised-button color="primary" (click)="downloadTemplate()">
            <mat-icon>download</mat-icon>
            Descargar Plantilla
        </button>
        <p class="help-text">Descarga la plantilla para asegurar el formato correcto</p>
    </div>

    <!-- Drop zone -->
    <div class="drop-zone" [class.dragging]="isDragging" [class.has-file]="selectedFile" (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" *ngIf="!uploadResult">

        <mat-icon class="upload-icon">cloud_upload</mat-icon>

        <div class="drop-zone-text" *ngIf="!selectedFile">
            <h3>Arrastra tu archivo de {{ uploadType | titlecase }} aquí</h3>
            <p>o</p>
            <label for="file-input" class="file-input-label">
                <button mat-raised-button color="accent">
                    <mat-icon>folder_open</mat-icon>
                    Seleccionar Archivo
                </button>
            </label>
            <input type="file" id="file-input" accept=".xlsx,.xls" (change)="onFileSelected($event)"
                style="display: none;">
            <p class="file-requirements">
                Archivos permitidos: .xlsx, .xls | Tamaño máximo: 5MB
            </p>
        </div>

        <div class="selected-file" *ngIf="selectedFile">
            <mat-icon class="file-icon">description</mat-icon>
            <div class="file-info">
                <h4>{{ selectedFile.name }}</h4>
                <p>{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
            </div>
            <div class="file-actions">
                <button mat-raised-button color="primary" (click)="uploadFile()" [disabled]="isUploading">
                    <mat-icon>upload</mat-icon>
                    Subir Archivo
                </button>
                <button mat-button (click)="cancelSelection()" [disabled]="isUploading">
                    <mat-icon>close</mat-icon>
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Progress bar -->
    <div class="progress-section" *ngIf="isUploading">
        <h3>Subiendo archivo...</h3>
        <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
    </div>

    <!-- Resultados -->
    <div class="results-section" *ngIf="uploadResult">
        <div class="results-header">
            <h3>Resultados de la Importación</h3>
            <button mat-button (click)="cancelSelection()">
                <mat-icon>refresh</mat-icon>
                Nueva Importación
            </button>
        </div>

        <!-- Mensaje Principal -->
        <div class="summary-message"
            [class.has-errors]="uploadResult.errores_filas && uploadResult.errores_filas.length > 0">
            <mat-icon>{{ (uploadResult.errores_filas && uploadResult.errores_filas.length > 0) ? 'warning' :
                'check_circle' }}</mat-icon>
            <p>{{ uploadResult.mensaje }}</p>
        </div>

        <!-- Tabla de errores -->
        <div class="errors-table" *ngIf="uploadResult.errores_filas && uploadResult.errores_filas.length > 0">
            <h4>Filas con Errores</h4>
            <table mat-table [dataSource]="uploadResult.errores_filas" class="error-table">
                <ng-container matColumnDef="fila">
                    <th mat-header-cell *matHeaderCellDef>Fila Excel</th>
                    <td mat-cell *matCellDef="let error">{{ error.fila_excel }}</td>
                </ng-container>

                <ng-container matColumnDef="errores">
                    <th mat-header-cell *matHeaderCellDef>Errores</th>
                    <td mat-cell *matCellDef="let error">{{ formatErrors(error.errores) }}</td>
                </ng-container>

                <ng-container matColumnDef="datos">
                    <th mat-header-cell *matHeaderCellDef>Datos Originales</th>
                    <td mat-cell *matCellDef="let error">{{ formatData(error.datos_originales) }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="errorColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: errorColumns;"></tr>
            </table>
        </div>
    </div>
</div>